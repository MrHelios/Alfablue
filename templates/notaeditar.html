{% extends "layout.html" %}
{% block style %}
    <link rel="stylesheet" href="{{url_for('static', filename='notas.css')}}">
{% endblock %}
{% block body %}
    <div id="sidebar-wrapper">
        <ul class="ul-editar">
          <li class="">
                <a href="{{url_for('notas_page.notaNueva')}}">
                    <input class="btn btn-success boton-editar" type="submit" value="">
                </a>
          </li>
          <li class="">
              <a href="{{url_for('notas_imagenes_page.nota_imagen', nota_id=notas_id)}}">
                  <input class="btn btn-primary boton-editar" type="submit" value="">
              </a>
          </li>
          <li class="">
              <input id="nota-borrar-btn" class="btn btn-danger boton-editar" type="submit" value="">
          </li>
        </ul>
    </div>

    <div class="contenedor-login">
        <div id="nota-editar">
            <h1 id="titulo-editar">Editar nota</h1>

            <div class="container-edit">
                <input id="titulo-nota" class="form-control" type="text" name="titulo" value="{{nota[1]}}">
                <textarea id="contenido-nota" class="form-control" name="contenido" rows="16" placeholder="Escribe aqui el contenido">{{nota[2]}}</textarea>
            </div>
        </div>

        <div id="nota-borrar">
            <h2>Borrar nota</h2>
            <p>No hay vuelta atr√°s.</p>
            <a id="a-notaBorrar" href=""></a>
            <input id="btn-notaBorrar" class="btn btn-danger" type="submit" value="Borrar">
        </div>
    </div>

    <script src="{{url_for('static', filename='jquery/jquery.min.js')}}"></script>
    <script type="text/javascript">
        function guardar() {
            if(estado_guardar = true) {
                t = document.getElementById("titulo-nota").value
                c = document.getElementById("contenido-nota").value
                $.ajax({
                    method: 'POST',
                    url: "{{url_for('notas_page.notaEditar', notas_id=notas_id)}}",
                    contentType: 'application/json',
                    data: {titulo: t, contenido: c}
                }).done(function(){
                    $('#titulo-editar-singuardado').attr('id','titulo-editar');
                    viejo = $('#contenido-nota').val();
                    estado_guardar = false;
                });
            }
        };

        setInterval(guardar, 15000);
    </script>
    <script type="text/javascript">
        function detectarCambio() {
            actual = $('#contenido-nota').val();
            if(viejo == actual) {
                viejo = actual;
            }
            else {
                $('#titulo-editar').attr('id','titulo-editar-singuardado');
                estado_guardar = true;
            }
        };

        estado_guardar = false;
        viejo = $('#contenido-nota').val();
        setInterval(detectarCambio, 2000);
    </script>
    <script type="text/javascript">
        estado_borrar = false;
        $('#nota-borrar').hide();

        $('#nota-borrar-btn').click(function() {
            if(!estado_borrar)
            {
                $('#nota-editar').hide();
                $('#nota-borrar').show();
                estado_borrar = true;
            }
            else
            {
                $('#nota-editar').show();
                $('#nota-borrar').hide();
                estado_borrar = false;
            }
        });
    </script>
    <script type="text/javascript">
        $("#btn-notaBorrar").click(function() {
            estado_guardar=false
            $.ajax({
                method: 'post',
                url: "{{url_for('notas_page.notaBorrar', notas_id=notas_id)}}",
                contentType: 'application/json',
                data: {nota_id:"{{notas_id}}"}
            }).done(function(){
                window.location.replace("{{url_for('notas_page.hola')}}");
            });
        });
    </script>
{% endblock %}
